<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Form View -->
    <record id="view_student_registration_form" model="ir.ui.view">
        <field name="name">student.registration.form</field>
        <field name="model">student.registration</field>
        <field name="arch" type="xml">
            <form string="Student Registration">
                <header>
                    <button name="action_submit" string="Submit" type="object" 
                            class="oe_highlight" 
                            invisible="state != 'draft'"/>
                    <button name="action_start_eligibility_review" string="Start Review" type="object" 
                            class="oe_highlight" 
                            invisible="state != 'submitted'"
                            groups="grants_training_suite_v19.group_manager,grants_training_suite_v19.group_agent"/>
                    <button name="action_approve_eligibility" string="Approve Eligibility" type="object" 
                            class="oe_highlight" 
                            invisible="state != 'eligibility_review'"
                            groups="grants_training_suite_v19.group_manager,grants_training_suite_v19.group_agent"/>
                    <button name="action_reject_eligibility" string="Reject" type="object" 
                            invisible="state != 'eligibility_review'"
                            groups="grants_training_suite_v19.group_manager,grants_training_suite_v19.group_agent"/>
                    <button name="action_approve_documents" string="Approve Documents" type="object" 
                            class="oe_highlight" 
                            invisible="state != 'document_review'"
                            groups="grants_training_suite_v19.group_manager,grants_training_suite_v19.group_agent"/>
                    <button name="action_reject_documents" string="Reject" type="object" 
                            invisible="state != 'document_review'"
                            groups="grants_training_suite_v19.group_manager,grants_training_suite_v19.group_agent"/>
                    <button name="action_final_approve" string="Finalize &amp; Create Student" type="object" 
                            class="oe_highlight" 
                            invisible="state != 'approved'"
                            groups="grants_training_suite_v19.group_manager,grants_training_suite_v19.group_agent"/>
                    <button name="action_enroll_student" string="Enroll in Courses" type="object" 
                            class="oe_highlight" 
                            invisible="state != 'approved' or not student_id"
                            groups="grants_training_suite_v19.group_manager,grants_training_suite_v19.group_agent"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,submitted,eligibility_review,document_review,approved,enrolled"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive" invisible="1">
                            <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Student Information">
                            <field name="student_name_english" readonly="state not in ['draft', 'submitted']"/>
                            <field name="student_name_arabic" readonly="state not in ['draft', 'submitted']"/>
                            <field name="birth_date" readonly="state not in ['draft', 'submitted']"/>
                            <field name="gender" readonly="state not in ['draft', 'submitted']"/>
                            <field name="nationality" readonly="state not in ['draft', 'submitted']"/>
                        </group>
                        <group string="Contact Information">
                            <field name="email" readonly="state not in ['draft', 'submitted']"/>
                            <field name="phone" readonly="state not in ['draft', 'submitted']"/>
                        </group>
                    </group>
                    <group>
                        <group string="Educational Background">
                            <field name="english_level" readonly="state not in ['draft', 'submitted']"/>
                            <field name="native_language" readonly="state not in ['draft', 'submitted']"/>
                            <field name="has_previous_certificate" readonly="state not in ['draft', 'submitted']"/>
                            <field name="certificate_type" readonly="state not in ['draft', 'submitted']" 
                                   invisible="not has_previous_certificate"/>
                        </group>
                        <group string="Course Request">
                            <field name="requested_courses" readonly="state not in ['draft', 'submitted']"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Review Information" groups="grants_training_suite_v19.group_manager,grants_training_suite_v19.group_agent">
                            <group>
                                <group>
                                    <field name="reviewer_id" readonly="1"/>
                                    <field name="approved_by" readonly="1"/>
                                    <field name="approved_date" readonly="1"/>
                                </group>
                                <group>
                                    <field name="student_id" readonly="1"/>
                                </group>
                            </group>
                            <group>
                                <field name="eligibility_notes" placeholder="Add eligibility review notes here..."/>
                            </group>
                            <group>
                                <field name="document_notes" placeholder="Add document review notes here..."/>
                            </group>
                            <group invisible="state != 'rejected'">
                                <field name="rejection_reason" placeholder="Reason for rejection..."/>
                            </group>
                        </page>
                        <page string="Documents">
                            <field name="attachment_ids" widget="many2many_binary" nolabel="1"/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>
    
    <!-- List View -->
    <record id="view_student_registration_tree" model="ir.ui.view">
        <field name="name">student.registration.list</field>
        <field name="model">student.registration</field>
        <field name="arch" type="xml">
            <list string="Student Registrations" 
                  decoration-info="state == 'draft'" 
                  decoration-warning="state == 'submitted'" 
                  decoration-primary="state in ['eligibility_review', 'document_review']" 
                  decoration-success="state in ['approved', 'enrolled']" 
                  decoration-danger="state == 'rejected'">
                <field name="name"/>
                <field name="student_name_english"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="state" widget="badge" 
                       decoration-info="state == 'draft'" 
                       decoration-warning="state == 'submitted'" 
                       decoration-primary="state in ['eligibility_review', 'document_review']" 
                       decoration-success="state in ['approved', 'enrolled']" 
                       decoration-danger="state == 'rejected'"/>
                <field name="create_date"/>
                <field name="reviewer_id"/>
            </list>
        </field>
    </record>
    
    <!-- Kanban View -->
    <record id="view_student_registration_kanban" model="ir.ui.view">
        <field name="name">student.registration.kanban</field>
        <field name="model">student.registration</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" default_group_by="state">
                <field name="name"/>
                <field name="student_name_english"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="state"/>
                <field name="create_date"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="name"/>
                                    </strong>
                                    <br/>
                                    <span class="o_kanban_record_subtitle">
                                        <field name="student_name_english"/>
                                    </span>
                                </div>
                                <span class="float-end">
                                    <field name="state" widget="label_selection" 
                                           options="{'classes': {'draft': 'info', 'submitted': 'warning', 'eligibility_review': 'primary', 'document_review': 'primary', 'approved': 'success', 'enrolled': 'success', 'rejected': 'danger'}}"/>
                                </span>
                            </div>
                            <div class="o_kanban_record_body">
                                <field name="email" widget="email"/>
                                <br/>
                                <field name="phone" widget="phone"/>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <span class="text-muted">
                                        <i class="fa fa-clock-o"/> <field name="create_date" widget="date"/>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- Search View - Temporarily commented out for debugging
    <record id="view_student_registration_search" model="ir.ui.view">
        <field name="name">student.registration.search</field>
        <field name="model">student.registration</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="student_name_english"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="reviewer_id"/>
                <filter string="Draft" name="filter_draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Submitted" name="filter_submitted" domain="[('state', '=', 'submitted')]"/>
                <filter string="Eligibility Review" name="filter_eligibility" domain="[('state', '=', 'eligibility_review')]"/>
                <filter string="Document Review" name="filter_document" domain="[('state', '=', 'document_review')]"/>
                <filter string="Approved" name="filter_approved" domain="[('state', '=', 'approved')]"/>
                <filter string="Rejected" name="filter_rejected" domain="[('state', '=', 'rejected')]"/>
                <filter string="Enrolled" name="filter_enrolled" domain="[('state', '=', 'enrolled')]"/>
                <separator/>
                <filter string="In Review" name="filter_in_review" domain="[('state', 'in', ('eligibility_review', 'document_review'))]"/>
                <group expand="0" string="Group By">
                    <filter string="Status" name="group_state" context="{'group_by': 'state'}"/>
                    <filter string="Reviewer" name="group_reviewer" context="{'group_by': 'reviewer_id'}"/>
                    <filter string="Create Date" name="group_create_date" context="{'group_by': 'create_date'}"/>
                </group>
            </search>
        </field>
    </record>
    -->
    
    <!-- Action -->
    <record id="action_student_registration" model="ir.actions.act_window">
        <field name="name">Student Registrations</field>
        <field name="res_model">student.registration</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="context">{'search_default_filter_submitted': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No student registrations yet
            </p>
            <p>
                Student registrations will appear here once students submit their registration forms via the portal.
            </p>
        </field>
    </record>
    
    <!-- Menu Items -->
    <menuitem id="menu_student_registrations_root" 
              name="Student Registrations" 
              sequence="50"
              web_icon="student_enrollment_portal,static/description/icon.png"/>
    
    <menuitem id="menu_student_registration_new" 
              name="New Registrations" 
              parent="menu_student_registrations_root" 
              action="action_student_registration" 
              sequence="10"/>
    
    <!-- Action for Eligibility Review -->
    <record id="action_student_registration_eligibility" model="ir.actions.act_window">
        <field name="name">Eligibility Review</field>
        <field name="res_model">student.registration</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="context">{'search_default_filter_eligibility': 1}</field>
        <field name="domain">[('state', '=', 'eligibility_review')]</field>
    </record>
    
    <menuitem id="menu_student_registration_eligibility" 
              name="Eligibility Review" 
              parent="menu_student_registrations_root" 
              action="action_student_registration_eligibility" 
              sequence="20"/>
    
    <!-- Action for Document Review -->
    <record id="action_student_registration_document" model="ir.actions.act_window">
        <field name="name">Document Review</field>
        <field name="res_model">student.registration</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="context">{'search_default_filter_document': 1}</field>
        <field name="domain">[('state', '=', 'document_review')]</field>
    </record>
    
    <menuitem id="menu_student_registration_document" 
              name="Document Review" 
              parent="menu_student_registrations_root" 
              action="action_student_registration_document" 
              sequence="30"/>
    
    <!-- Action for Approved -->
    <record id="action_student_registration_approved" model="ir.actions.act_window">
        <field name="name">Approved Registrations</field>
        <field name="res_model">student.registration</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_filter_approved': 1}</field>
        <field name="domain">[('state', '=', 'approved')]</field>
    </record>
    
    <menuitem id="menu_student_registration_approved" 
              name="Approved" 
              parent="menu_student_registrations_root" 
              action="action_student_registration_approved" 
              sequence="40"/>
    
    <!-- Action for Rejected -->
    <record id="action_student_registration_rejected" model="ir.actions.act_window">
        <field name="name">Rejected Registrations</field>
        <field name="res_model">student.registration</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_filter_rejected': 1}</field>
        <field name="domain">[('state', '=', 'rejected')]</field>
    </record>
    
    <menuitem id="menu_student_registration_rejected" 
              name="Rejected" 
              parent="menu_student_registrations_root" 
              action="action_student_registration_rejected" 
              sequence="50"/>
    
    <!-- Action for All Registrations -->
    <record id="action_student_registration_all" model="ir.actions.act_window">
        <field name="name">All Registrations</field>
        <field name="res_model">student.registration</field>
        <field name="view_mode">list,kanban,form</field>
    </record>
    
    <menuitem id="menu_student_registration_all" 
              name="All Registrations" 
              parent="menu_student_registrations_root" 
              action="action_student_registration_all" 
              sequence="60"/>
    
</odoo>

