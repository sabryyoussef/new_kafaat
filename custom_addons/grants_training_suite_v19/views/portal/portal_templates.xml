<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Portal Home Page -->
    <template id="portal_home" name="Grants Training Portal Home">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <section class="s_banner pt96 pb96 o_colored_level" data-snippet="s_banner" data-name="Banner">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-7 pt16 pb16">
                                <h1 class="display-3 fw-bold">Welcome to Grants Training Portal</h1>
                                <p class="lead">Start your learning journey today. Register for courses and track your progress.</p>
                                <div class="s_banner_buttons d-flex flex-wrap gap-2 pt24">
                                    <a href="/student/register" class="btn btn-primary btn-lg">Register Now</a>
                                    <a href="/grants/login" class="btn btn-outline-primary btn-lg">Login</a>
                                    <a href="/grants/courses/catalog" class="btn btn-secondary btn-lg">Browse Courses</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Features Section -->
                <section class="s_features pt64 pb64" data-snippet="s_features">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body text-center p-4">
                                        <i class="fa fa-graduation-cap fa-3x text-primary mb-3"></i>
                                        <h4>Quality Training</h4>
                                        <p>Access high-quality training courses designed by experts.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body text-center p-4">
                                        <i class="fa fa-certificate fa-3x text-success mb-3"></i>
                                        <h4>Get Certified</h4>
                                        <p>Earn certificates upon completion of your courses.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body text-center p-4">
                                        <i class="fa fa-chart-line fa-3x text-info mb-3"></i>
                                        <h4>Track Progress</h4>
                                        <p>Monitor your learning progress and achievements.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </t>
    </template>

    <!-- ============================================================================
         OLD REGISTRATION TEMPLATES - REMOVED
         ============================================================================
         
         Student registration is now handled by the 'student_enrollment_portal' module.
         
         - Route: /student/register
         - Features: Multi-step approval workflow, document upload, admin review
         - All links in this file have been updated to point to /student/register
         
         Old templates removed to prevent XML syntax errors with nested comments.
         ============================================================================ -->

    <!-- Student Dashboard -->
    <template id="portal_student_dashboard" name="Student Dashboard">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <t t-call="portal.portal_searchbar">
                <t t-set="title">My Dashboard</t>
            </t>
            
            <div class="row mt-4">
                <!-- Student Info Card -->
                <div class="col-lg-4 mb-4">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title mb-3">Student Information</h5>
                            <p><strong>Name:</strong> <t t-esc="student.name"/></p>
                            <p><strong>Email:</strong> <t t-esc="student.email"/></p>
                            <p><strong>Phone:</strong> <t t-esc="student.phone"/></p>
                            <p><strong>Status:</strong> 
                                <span t-att-class="'badge ' + ('bg-success' if student.state == 'enrolled' else 'bg-warning')">
                                    <t t-esc="dict(student._fields['state'].selection).get(student.state)"/>
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Progress Card -->
                <div class="col-lg-4 mb-4">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title mb-3">Learning Progress</h5>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Overall Progress</span>
                                    <span><t t-esc="round(progress, 1)"/>%</span>
                                </div>
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-success" role="progressbar" 
                                         t-att-style="'width: ' + str(progress) + '%'" 
                                         t-att-aria-valuenow="progress" aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                            <p class="mb-1"><strong>Total Sessions:</strong> <t t-esc="len(courses)"/></p>
                            <p class="mb-1"><strong>Completed:</strong> <t t-esc="len(courses.filtered(lambda c: c.state == 'completed'))"/></p>
                            <p class="mb-1"><strong>Certificates:</strong> <t t-esc="len(certificates)"/></p>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions Card -->
                <div class="col-lg-4 mb-4">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title mb-3">Quick Actions</h5>
                            <div class="d-grid gap-2">
                                <a href="/my/courses" class="btn btn-primary">
                                    <i class="fa fa-book me-2"></i>My Courses
                                </a>
                                <a href="/my/certificates" class="btn btn-success">
                                    <i class="fa fa-certificate me-2"></i>My Certificates
                                </a>
                                <a href="/my/available-courses" class="btn btn-info">
                                    <i class="fa fa-search me-2"></i>Browse Courses
                                </a>
                                <a href="/my/enrollment-requests" class="btn btn-warning">
                                    <i class="fa fa-list me-2"></i>My Requests
                                    <t t-if="pending_requests">
                                        <span class="badge bg-danger ms-2"><t t-esc="len(pending_requests)"/></span>
                                    </t>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Enrollment Requests Section -->
            <div class="row mb-4" t-if="pending_requests">
                <div class="col-12">
                    <div class="alert alert-warning">
                        <h5 class="alert-heading">
                            <i class="fa fa-clock-o"></i> Pending Enrollment Requests
                        </h5>
                        <p>You have <strong><t t-esc="len(pending_requests)"/></strong> pending enrollment request(s).</p>
                        <a href="/my/enrollment-requests" class="btn btn-sm btn-warning">
                            View All Requests <i class="fa fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Available Courses Section -->
            <div class="row mb-4" t-if="available_courses">
                <div class="col-12">
                    <h4 class="mb-3">
                        <i class="fa fa-graduation-cap"></i> Recommended Courses
                    </h4>
                </div>
                <t t-foreach="available_courses" t-as="course">
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title"><t t-esc="course.name"/></h6>
                                <p class="card-text text-muted small" t-if="course.elearning_course_id">
                                    <t t-esc="course.elearning_course_id.description[:100] if course.elearning_course_id.description else 'No description'"/>...
                                </p>
                                <a t-attf-href="/my/courses/request/{{ course.id }}" class="btn btn-sm btn-primary">
                                    <i class="fa fa-paper-plane"></i> Request Enrollment
                                </a>
                            </div>
                        </div>
                    </div>
                </t>
                <div class="col-12 mt-2">
                    <a href="/my/available-courses" class="btn btn-outline-primary">
                        View All Available Courses <i class="fa fa-arrow-right"></i>
                    </a>
                </div>
            </div>
            
            <!-- Recent Courses -->
            <div class="row">
                <div class="col-12">
                    <h4 class="mb-3">Recent Course Sessions</h4>
                    <t t-if="courses">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Session</th>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="courses[:5]" t-as="session">
                                        <tr>
                                            <td><t t-esc="session.name"/></td>
                                            <td><t t-esc="session.session_date.strftime('%Y-%m-%d %H:%M') if session.session_date else 'N/A'"/></td>
                                            <td><t t-esc="dict(session._fields['session_type'].selection).get(session.session_type)"/></td>
                                            <td>
                                                <span t-att-class="'badge ' + ('bg-success' if session.state == 'completed' else 'bg-warning')">
                                                    <t t-esc="dict(session._fields['state'].selection).get(session.state)"/>
                                                </span>
                                            </td>
                                            <td>
                                                <a t-attf-href="/my/courses/#{session.id}" class="btn btn-sm btn-primary">View</a>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="alert alert-info">
                            <p class="mb-0">No course sessions yet. <a href="/grants/courses/catalog">Browse available courses</a> to get started.</p>
                        </div>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- My Courses Page -->
    <template id="portal_my_courses" name="My Courses">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <t t-call="portal.portal_searchbar">
                <t t-set="title">My Courses</t>
            </t>
            
            <div class="row mt-4">
                <t t-if="sessions">
                    <t t-foreach="sessions" t-as="session">
                        <div class="col-lg-4 mb-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <h5 class="card-title"><t t-esc="session.name"/></h5>
                                    <p class="text-muted mb-2">
                                        <i class="fa fa-calendar me-2"></i>
                                        <t t-esc="session.session_date.strftime('%Y-%m-%d %H:%M') if session.session_date else 'N/A'"/>
                                    </p>
                                    <p class="mb-2">
                                        <span t-att-class="'badge ' + ('bg-success' if session.state == 'completed' else 'bg-warning')">
                                            <t t-esc="dict(session._fields['state'].selection).get(session.state)"/>
                                        </span>
                                    </p>
                                    <p class="card-text"><t t-esc="session.session_topic or 'No topic specified'"/></p>
                                    <a t-attf-href="/my/courses/#{session.id}" class="btn btn-primary">View Details</a>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
                <t t-else="">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <p class="mb-0">You are not enrolled in any courses yet. <a href="/grants/courses/catalog">Browse available courses</a>.</p>
                        </div>
                    </div>
                </t>
            </div>
        </t>
    </template>

    <!-- Course Detail Page -->
    <template id="portal_course_detail" name="Course Detail">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <t t-call="portal.portal_searchbar">
                <t t-set="title"><t t-esc="session.name"/></t>
            </t>
            
            <div class="row mt-4">
                <div class="col-lg-8">
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <h3 class="card-title"><t t-esc="session.name"/></h3>
                            <hr/>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <p><strong>Date:</strong> <t t-esc="session.session_date.strftime('%Y-%m-%d %H:%M') if session.session_date else 'N/A'"/></p>
                                    <p><strong>Duration:</strong> <t t-esc="session.session_duration"/> hours</p>
                                    <p><strong>Type:</strong> <t t-esc="dict(session._fields['session_type'].selection).get(session.session_type)"/></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Status:</strong> 
                                        <span t-att-class="'badge ' + ('bg-success' if session.state == 'completed' else 'bg-warning')">
                                            <t t-esc="dict(session._fields['state'].selection).get(session.state)"/>
                                        </span>
                                    </p>
                                    <p t-if="session.location"><strong>Location:</strong> <t t-esc="session.location"/></p>
                                    <p t-if="session.meeting_link">
                                        <strong>Meeting Link:</strong> 
                                        <a t-att-href="session.meeting_link" target="_blank">Join Meeting</a>
                                    </p>
                                </div>
                            </div>
                            
                            <t t-if="session.session_topic">
                                <h5>Topic</h5>
                                <p><t t-esc="session.session_topic"/></p>
                            </t>
                            
                            <t t-if="session.session_objectives">
                                <h5>Objectives</h5>
                                <p><t t-esc="session.session_objectives"/></p>
                            </t>
                            
                            <t t-if="session.session_notes">
                                <h5>Notes</h5>
                                <p><t t-esc="session.session_notes"/></p>
                            </t>
                            
                            <t t-if="session.homework_assigned">
                                <h5>Homework</h5>
                                <p><t t-esc="session.homework_assigned"/></p>
                                <p t-if="session.homework_due_date" class="text-muted">
                                    <strong>Due Date:</strong> <t t-esc="session.homework_due_date.strftime('%Y-%m-%d')"/>
                                </p>
                            </t>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">Session Details</h5>
                            <hr/>
                            <t t-if="session.progress_percentage">
                                <p><strong>Progress:</strong> <t t-esc="round(session.progress_percentage, 1)"/>%</p>
                                <div class="progress mb-3" style="height: 20px;">
                                    <div class="progress-bar bg-success" role="progressbar" 
                                         t-att-style="'width: ' + str(session.progress_percentage) + '%'">
                                    </div>
                                </div>
                            </t>
                            
                            <t t-if="session.attendance_status">
                                <p><strong>Attendance:</strong> <t t-esc="dict(session._fields['attendance_status'].selection).get(session.attendance_status)"/></p>
                            </t>
                            
                            <t t-if="session.student_engagement">
                                <p><strong>Engagement:</strong> <t t-esc="dict(session._fields['student_engagement'].selection).get(session.student_engagement)"/></p>
                            </t>
                            
                            <t t-if="session.session_rating">
                                <p><strong>Rating:</strong> <t t-esc="dict(session._fields['session_rating'].selection).get(session.session_rating)"/></p>
                            </t>
                            
                            <div class="mt-4">
                                <a href="/my/courses" class="btn btn-primary w-100">Back to My Courses</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- My Certificates Page -->
    <template id="portal_my_certificates" name="My Certificates">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <t t-call="portal.portal_searchbar">
                <t t-set="title">My Certificates</t>
            </t>
            
            <div class="row mt-4">
                <t t-if="certificates">
                    <t t-foreach="certificates" t-as="cert">
                        <div class="col-lg-6 mb-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <i class="fa fa-certificate fa-3x text-warning mb-3"></i>
                                    <h5 class="card-title"><t t-esc="cert.certificate_name"/></h5>
                                    <p class="text-muted">
                                        <strong>Issued:</strong> 
                                        <t t-esc="cert.issue_date.strftime('%Y-%m-%d') if cert.issue_date else 'N/A'"/>
                                    </p>
                                    <p><strong>Status:</strong> 
                                        <span t-att-class="'badge ' + ('bg-success' if cert.state == 'issued' else 'bg-warning')">
                                            <t t-esc="dict(cert._fields['state'].selection).get(cert.state)"/>
                                        </span>
                                    </p>
                                    <t t-if="cert.state == 'issued'">
                                        <a href="#" class="btn btn-primary">Download Certificate</a>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
                <t t-else="">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <p class="mb-0">You don't have any certificates yet. Complete your courses to earn certificates!</p>
                        </div>
                    </div>
                </t>
            </div>
        </t>
    </template>

    <!-- No Student Found -->
    <template id="portal_no_student" name="No Student Found">
        <t t-call="portal.portal_layout">
            <div class="row mt-5">
                <div class="col-12 text-center">
                    <i class="fa fa-user-slash fa-5x text-muted mb-4"></i>
                    <h3>No Student Record Found</h3>
                    <p class="lead">We couldn't find a student record associated with your account.</p>
                    <p>Please contact support for assistance.</p>
                    <a href="/grants" class="btn btn-primary mt-3">Back to Home</a>
                </div>
            </div>
        </t>
    </template>

    <!-- Public Course Catalog -->
    <template id="portal_course_catalog" name="Course Catalog">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <section class="pt48 pb48">
                    <div class="container">
                        <h1 class="text-center mb-5">Available Courses</h1>
                        
                        <div class="row">
                            <t t-if="courses">
                                <t t-foreach="courses" t-as="course">
                                    <div class="col-lg-4 mb-4">
                                        <div class="card h-100 border-0 shadow-sm">
                                            <div class="card-body">
                                                <h5 class="card-title"><t t-esc="course.name"/></h5>
                                                <p class="text-muted mb-2">
                                                    <span class="badge bg-primary"><t t-esc="dict(course._fields['status'].selection).get(course.status)"/></span>
                                                </p>
                                                <p class="card-text" t-if="course.elearning_course_id and course.elearning_course_id.description">
                                                    <t t-esc="course.elearning_course_id.description[:150]"/>...
                                                </p>
                                                <div class="d-grid gap-2">
                                                <a t-attf-href="/grants/courses/#{course.id}" class="btn btn-primary">Learn More</a>
                                                    <t t-if="request.env.user._is_public()">
                                                        <a t-attf-href="/student/register?course_id=#{course.id}" class="btn btn-success">
                                                            <i class="fa fa-user-plus"></i> Register &amp; Enroll
                                                        </a>
                                                    </t>
                                                    <t t-else="">
                                                        <a t-attf-href="/my/courses/request/#{course.id}" class="btn btn-outline-success">
                                                            <i class="fa fa-paper-plane"></i> Request Enrollment
                                                        </a>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </t>
                            <t t-else="">
                                <div class="col-12">
                                    <div class="alert alert-info text-center">
                                        <p class="mb-0">No courses available at the moment. Please check back later.</p>
                                    </div>
                                </div>
                            </t>
                        </div>
                        
                        <div class="text-center mt-5">
                            <a href="/student/register" class="btn btn-lg btn-primary">Register Now</a>
                        </div>
                    </div>
                </section>
            </div>
        </t>
    </template>

    <!-- Public Course Detail -->
    <template id="portal_course_detail_public" name="Course Detail (Public)">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <section class="pt48 pb48">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-8">
                                <h1 class="mb-4"><t t-esc="course.name"/></h1>
                                
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-body">
                                        <h4>About This Course</h4>
                                        <p t-if="course.elearning_course_id and course.elearning_course_id.description">
                                            <t t-esc="course.elearning_course_id.description"/>
                                        </p>
                                        <p t-else="">Course description not available.</p>
                                        
                                        <h5 class="mt-4">Course Details</h5>
                                        <ul>
                                            <li><strong>Status:</strong> <t t-esc="dict(course._fields['status'].selection).get(course.status)"/></li>
                                            <li t-if="course.elearning_course_id">
                                                <strong>eLearning Course:</strong> <t t-esc="course.elearning_course_id.name"/>
                                            </li>
                                            <li t-if="course.training_program_id">
                                                <strong>Training Program:</strong> <t t-esc="course.training_program_id.name"/>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm sticky-top" style="top: 100px;">
                                    <div class="card-body">
                                        <h5 class="card-title">Ready to Enroll?</h5>
                                        <t t-if="request.env.user._is_public()">
                                            <p class="card-text">Register as a new student to enroll in this course.</p>
                                            <div class="d-grid gap-2">
                                                <a t-attf-href="/student/register?course_id={{ course.id }}" class="btn btn-success btn-lg">
                                                    <i class="fa fa-user-plus"></i> Register &amp; Enroll
                                                </a>
                                                <a href="/grants/login" class="btn btn-outline-primary">
                                                    <i class="fa fa-sign-in"></i> Already Registered? Login
                                                </a>
                                    </div>
                                        </t>
                                        <t t-else="">
                                            <p class="card-text">Request enrollment in this course to start your learning journey.</p>
                                            <div class="d-grid gap-2">
                                                <a t-attf-href="/my/courses/request/{{ course.id }}" class="btn btn-success btn-lg">
                                                    <i class="fa fa-paper-plane"></i> Request Enrollment
                                                </a>
                                                <a href="/my/student" class="btn btn-outline-primary">
                                                    <i class="fa fa-home"></i> My Dashboard
                                                </a>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-5">
                            <a href="/grants/courses/catalog" class="btn btn-secondary">Back to Course Catalog</a>
                        </div>
                    </div>
                </section>
            </div>
        </t>
    </template>
    
    <!-- Phase 4: Enhanced Portal Templates -->
    
    <!-- Enrollment Tracking Template -->
    <template id="portal_enrollments" name="My Enrollments">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar"/>
            
            <div class="container mt-4">
                <h2>My Course Enrollments</h2>
                
                <!-- Summary Cards -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 t-esc="total_courses"/>
                                <p>Total Courses</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 t-esc="active_courses"/>
                                <p>Active Courses</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3 t-esc="completed_courses"/>
                                <p>Completed</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Enrollment List -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Course</th>
                                <th>Status</th>
                                <th>Completion</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="enrollments" t-as="enrollment">
                                <tr>
                                    <td t-esc="enrollment['course_name']"/>
                                    <td><span class="badge" t-att-class="'badge-' + enrollment['status']" t-esc="enrollment['status']"/></td>
                                    <td>
                                        <div class="progress">
                                            <div class="progress-bar" t-att-style="'width: %s%%' % enrollment['completion']" t-esc="'%s%%' % enrollment['completion']"/>
                                        </div>
                                    </td>
                                    <td>
                                        <a t-attf-href="/my/courses/#{enrollment['session'].id}" class="btn btn-sm btn-primary">View Details</a>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Certificate Download Enhancement - Add download button to existing template -->
    <template id="portal_my_certificates_enhanced" name="My Certificates Enhanced" inherit_id="grants_training_suite_v19.portal_my_certificates">
        <xpath expr="//div[hasclass('card-body')]//p[last()]" position="after">
            <a t-attf-href="/my/certificates/#{cert.id}/download" class="btn btn-primary btn-sm mt-2">
                <i class="fa fa-download"/> Download PDF
            </a>
        </xpath>
    </template>
    
    <!-- DOCUMENT MANAGEMENT TEMPLATES MOVED TO student_documents_portal MODULE -->
    <!-- Templates: portal_documents, portal_document_request_form, portal_document_detail -->
    <!-- Routes: /my/documents, /my/documents/new, /my/documents/<id> -->
    
    <!-- COMMENTED OUT - Portal Menu Enhancement - portal.portal_my_home_menu may not exist in this Odoo version
    <template id="portal_my_home_menu_student" name="Portal My Home Menu - Student" inherit_id="portal.portal_my_home_menu">
        <xpath expr="//div[hasclass('o_portal_my_home_menu')]" position="inside">
            <a href="/my/enrollments" class="list-group-item list-group-item-action">
                <i class="fa fa-graduation-cap"/> My Enrollments
            </a>
            <a href="/my/certificates" class="list-group-item list-group-item-action">
                <i class="fa fa-certificate"/> My Certificates
            </a>
            <a href="/my/documents" class="list-group-item list-group-item-action">
                <i class="fa fa-file"/> Document Requests
            </a>
        </xpath>
    </template>
    -->
    
    <!-- Course Enrollment Request Templates -->
    
    <!-- Available Courses Page -->
    <template id="portal_available_courses" name="Available Courses">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Available Courses</t>
            </t>
            
            <div class="container mt-4">
                <div class="row">
                    <div class="col-12">
                        <h3>Available Courses</h3>
                        <p class="text-muted">Browse and request enrollment in available courses</p>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <t t-if="not courses">
                        <div class="col-12">
                            <div class="alert alert-info">
                                <i class="fa fa-info-circle"/> No courses available at this time.
                            </div>
                        </div>
                    </t>
                    
                    <t t-foreach="courses" t-as="course">
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <t t-esc="course.name"/>
                                    </h5>
                                    <p class="card-text text-muted" t-if="course.elearning_course_id">
                                        <t t-esc="course.elearning_course_id.description or 'No description available'"/>
                                    </p>
                                    <div class="mt-3">
                                        <t t-if="course.id in pending_course_ids">
                                            <span class="badge bg-warning">
                                                <i class="fa fa-clock-o"/> Request Pending
                                            </span>
                                        </t>
                                        <t t-else="">
                                            <a t-attf-href="/my/courses/request/{{ course.id }}" 
                                               class="btn btn-primary btn-sm">
                                                <i class="fa fa-paper-plane"/> Request Enrollment
                                            </a>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Enrollment Request Form -->
    <template id="portal_enrollment_request_form" name="Enrollment Request Form">
        <t t-call="portal.portal_layout">
            <div class="container mt-4">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="card-title">Request Course Enrollment</h3>
                                <hr/>
                                
                                <div class="alert alert-info">
                                    <strong>Course:</strong> <t t-esc="course.name"/>
                                </div>
                                
                                <form action="/my/courses/request/submit" method="POST">
                                    <input type="hidden" name="course_id" t-att-value="course.id"/>
                                    
                                    <div class="mb-3">
                                        <label for="notes" class="form-label">
                                            Why do you want to enroll in this course?
                                        </label>
                                        <textarea class="form-control" id="notes" name="notes" 
                                                  rows="5" placeholder="Tell us about your interest in this course..."></textarea>
                                        <small class="form-text text-muted">
                                            Optional: Share your motivation and goals for taking this course
                                        </small>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between">
                                        <a href="/my/available-courses" class="btn btn-secondary">
                                            <i class="fa fa-arrow-left"/> Back
                                        </a>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fa fa-paper-plane"/> Submit Request
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Enrollment Request Success -->
    <template id="portal_enrollment_request_success" name="Enrollment Request Success">
        <t t-call="portal.portal_layout">
            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6 text-center">
                        <div class="card">
                            <div class="card-body p-5">
                                <i class="fa fa-check-circle fa-5x text-success mb-4"></i>
                                <h2 class="mb-4">Request Submitted!</h2>
                                <p class="lead">Your enrollment request has been submitted successfully.</p>
                                
                                <div class="alert alert-info text-start mt-4">
                                    <p class="mb-2"><strong>Request Number:</strong> <t t-esc="request.name"/></p>
                                    <p class="mb-2"><strong>Course:</strong> <t t-esc="course.name"/></p>
                                    <p class="mb-0"><strong>Status:</strong> <span class="badge bg-warning">Pending Review</span></p>
                                </div>
                                
                                <p class="mt-4">
                                    Our team will review your request and notify you via email once it's been processed.
                                </p>
                                
                                <div class="mt-5">
                                    <a href="/my/enrollment-requests" class="btn btn-primary me-2">
                                        <i class="fa fa-list"/> View My Requests
                                    </a>
                                    <a href="/my/student" class="btn btn-secondary">
                                        <i class="fa fa-home"/> Back to Dashboard
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Enrollment Request Error -->
    <template id="portal_enrollment_request_error" name="Enrollment Request Error">
        <t t-call="portal.portal_layout">
            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6 text-center">
                        <div class="card">
                            <div class="card-body p-5">
                                <i class="fa fa-exclamation-triangle fa-5x text-danger mb-4"></i>
                                <h2 class="mb-4">Request Failed</h2>
                                
                                <div class="alert alert-danger text-start">
                                    <t t-esc="error"/>
                                </div>
                                
                                <div class="mt-5">
                                    <a href="/my/available-courses" class="btn btn-primary me-2">
                                        <i class="fa fa-arrow-left"/> Back to Courses
                                    </a>
                                    <a href="/my/student" class="btn btn-secondary">
                                        <i class="fa fa-home"/> Dashboard
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- My Enrollment Requests -->
    <template id="portal_my_enrollment_requests" name="My Enrollment Requests">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <t t-call="portal.portal_searchbar">
                <t t-set="title">My Enrollment Requests</t>
            </t>
            
            <div class="container mt-4">
                <div class="row">
                    <div class="col-12">
                        <h3>My Enrollment Requests</h3>
                        <p class="text-muted">Track the status of your course enrollment requests</p>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <t t-if="not requests">
                            <div class="alert alert-info">
                                <i class="fa fa-info-circle"/> You haven't submitted any enrollment requests yet.
                                <a href="/my/available-courses" class="alert-link">Browse available courses</a>
                            </div>
                        </t>
                        
                        <t t-else="">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Request #</th>
                                            <th>Course</th>
                                            <th>Request Date</th>
                                            <th>Status</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="requests" t-as="req">
                                            <tr>
                                                <td><t t-esc="req.name"/></td>
                                                <td><strong><t t-esc="req.course_name"/></strong></td>
                                                <td><t t-esc="req.request_date" t-options="{'widget': 'date'}"/></td>
                                                <td>
                                                    <t t-if="req.state == 'draft'">
                                                        <span class="badge bg-secondary">Draft</span>
                                                    </t>
                                                    <t t-elif="req.state == 'pending'">
                                                        <span class="badge bg-warning">Pending</span>
                                                    </t>
                                                    <t t-elif="req.state == 'approved'">
                                                        <span class="badge bg-success">Approved</span>
                                                    </t>
                                                    <t t-elif="req.state == 'rejected'">
                                                        <span class="badge bg-danger">Rejected</span>
                                                    </t>
                                                </td>
                                                <td>
                                                    <t t-if="req.state == 'approved' and req.session_id">
                                                        <a t-attf-href="/my/courses/{{ req.session_id.id }}" 
                                                           class="btn btn-sm btn-primary">
                                                            <i class="fa fa-eye"/> View Session
                                                        </a>
                                                    </t>
                                                    <t t-elif="req.state == 'rejected' and req.rejection_reason">
                                                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                                                data-bs-toggle="popover" 
                                                                t-att-data-bs-content="req.rejection_reason"
                                                                title="Rejection Reason">
                                                            <i class="fa fa-info-circle"/> Reason
                                                        </button>
                                                    </t>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </t>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <a href="/my/available-courses" class="btn btn-primary">
                            <i class="fa fa-plus"/> Request New Course
                        </a>
                        <a href="/my/student" class="btn btn-secondary">
                            <i class="fa fa-home"/> Back to Dashboard
                        </a>
                    </div>
                </div>
            </div>
            
            <script>
                // Initialize Bootstrap popovers
                var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
                var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
                    return new bootstrap.Popover(popoverTriggerEl)
                })
            </script>
        </t>
    </template>
    
</odoo>
