<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- No Student Found Template -->
    <template id="portal_no_student" name="No Student Record">
        <t t-call="portal.portal_layout">
            <div class="container mt-5">
                <div class="alert alert-warning">
                    <h4>No Student Record Found</h4>
                    <p>We couldn't find a student record associated with your account.</p>
                    <p>Please contact the academy administration for assistance.</p>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Document Requests List -->
    <template id="portal_documents" name="My Document Requests">
        <t t-call="portal.portal_layout">
            <div class="container mt-4">
                <div class="d-flex justify-content-between mb-3">
                    <h2>Document Requests</h2>
                    <a href="/my/documents/new" class="btn btn-primary">
                        <i class="fa fa-plus"/> New Request
                    </a>
                </div>
                
                <t t-if="not document_requests">
                    <div class="alert alert-info">
                        <i class="fa fa-info-circle"/> You haven't made any document requests yet.
                    </div>
                </t>
                
                <t t-if="document_requests">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Request #</th>
                                    <th>Type</th>
                                    <th>Document</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="document_requests" t-as="req">
                                    <tr>
                                        <td>
                                            <strong t-esc="req.name"/>
                                        </td>
                                        <td>
                                            <span t-if="req.request_type == 'upload'" class="badge badge-info">
                                                <i class="fa fa-upload"/> Upload
                                            </span>
                                            <span t-if="req.request_type == 'download'" class="badge badge-warning">
                                                <i class="fa fa-download"/> Request
                                            </span>
                                        </td>
                                        <td t-esc="dict(req._fields['document_type'].selection).get(req.document_type)"/>
                                        <td>
                                            <span t-if="req.status == 'draft'" class="badge badge-secondary">Draft</span>
                                            <span t-if="req.status == 'submitted'" class="badge badge-primary">Submitted</span>
                                            <span t-if="req.status == 'in_progress'" class="badge badge-info">In Progress</span>
                                            <span t-if="req.status == 'completed'" class="badge badge-success">
                                                <i class="fa fa-check"/> Completed
                                            </span>
                                            <span t-if="req.status == 'rejected'" class="badge badge-danger">
                                                <i class="fa fa-times"/> Rejected
                                            </span>
                                        </td>
                                        <td t-field="req.create_date" t-options='{"widget": "date"}'/>
                                        <td>
                                            <a t-attf-href="/my/documents/#{req.id}" class="btn btn-sm btn-secondary">
                                                <i class="fa fa-eye"/> View
                                            </a>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </t>
            </div>
        </t>
    </template>
    
    <!-- Document Request Form -->
    <template id="portal_document_request_form" name="New Document Request">
        <t t-call="portal.portal_layout">
            <div class="container mt-4">
                <h2>
                    <i class="fa fa-file-text"/> New Document Request
                </h2>
                
                <t t-if="error">
                    <div class="alert alert-danger" role="alert">
                        <i class="fa fa-exclamation-circle"/> <t t-esc="error"/>
                    </div>
                </t>
                
                <div class="card mt-4">
                    <div class="card-body">
                        <form action="/my/documents/new" method="post" enctype="multipart/form-data">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            
                            <div class="form-group">
                                <label for="request_type">
                                    <i class="fa fa-question-circle"/> Request Type *
                                </label>
                                <select name="request_type" id="request_type" class="form-control" required="1">
                                    <option value="">-- Select Type --</option>
                                    <option value="upload">Upload Document</option>
                                    <option value="download">Request Academy Document</option>
                                </select>
                                <small class="form-text text-muted">
                                    Choose "Upload" to submit your documents, or "Request" to ask for academy documents.
                                </small>
                            </div>
                            
                            <div class="form-group">
                                <label for="document_type">
                                    <i class="fa fa-file"/> Document Type *
                                </label>
                                <select name="document_type" id="document_type" class="form-control" required="1">
                                    <option value="">-- Select Document Type --</option>
                                    <option value="id">ID/Passport</option>
                                    <option value="transcript">Transcript</option>
                                    <option value="certificate">Certificate</option>
                                    <option value="attendance">Attendance Record</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="description">
                                    <i class="fa fa-pencil"/> Description
                                </label>
                                <textarea name="description" id="description" class="form-control" rows="3" placeholder="Provide additional details about your request..."/>
                            </div>
                            
                            <div class="form-group">
                                <label for="file">
                                    <i class="fa fa-paperclip"/> Attach File (for uploads)
                                </label>
                                <input type="file" name="file" id="file" class="form-control-file"/>
                                <small class="form-text text-muted">
                                    Only attach a file if you are uploading a document. Maximum file size: 10MB.
                                </small>
                            </div>
                            
                            <div class="form-group mt-4">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fa fa-paper-plane"/> Submit Request
                                </button>
                                <a href="/my/documents" class="btn btn-secondary">
                                    <i class="fa fa-times"/> Cancel
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Document Request Detail -->
    <template id="portal_document_detail" name="Document Request Detail">
        <t t-call="portal.portal_layout">
            <div class="container mt-4">
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h2>
                                <i class="fa fa-file-text"/> Document Request: <t t-esc="request.name"/>
                            </h2>
                            <a href="/my/documents" class="btn btn-secondary">
                                <i class="fa fa-arrow-left"/> Back to List
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5>Request Details</h5>
                            </div>
                            <div class="card-body">
                                <dl class="row">
                                    <dt class="col-sm-4">Request Number:</dt>
                                    <dd class="col-sm-8"><t t-esc="request.name"/></dd>
                                    
                                    <dt class="col-sm-4">Request Type:</dt>
                                    <dd class="col-sm-8">
                                        <span t-if="request.request_type == 'upload'" class="badge badge-info">Upload Document</span>
                                        <span t-if="request.request_type == 'download'" class="badge badge-warning">Request Document</span>
                                    </dd>
                                    
                                    <dt class="col-sm-4">Document Type:</dt>
                                    <dd class="col-sm-8"><t t-esc="dict(request._fields['document_type'].selection).get(request.document_type)"/></dd>
                                    
                                    <dt class="col-sm-4">Request Date:</dt>
                                    <dd class="col-sm-8"><t t-field="request.create_date" t-options='{"widget": "datetime"}'/></dd>
                                    
                                    <dt class="col-sm-4">Status:</dt>
                                    <dd class="col-sm-8">
                                        <span t-if="request.status == 'draft'" class="badge badge-secondary">Draft</span>
                                        <span t-if="request.status == 'submitted'" class="badge badge-primary">Submitted</span>
                                        <span t-if="request.status == 'in_progress'" class="badge badge-info">In Progress</span>
                                        <span t-if="request.status == 'completed'" class="badge badge-success">Completed</span>
                                        <span t-if="request.status == 'rejected'" class="badge badge-danger">Rejected</span>
                                    </dd>
                                </dl>
                                
                                <t t-if="request.description">
                                    <hr/>
                                    <h6>Description:</h6>
                                    <p t-esc="request.description"/>
                                </t>
                            </div>
                        </div>
                        
                        <t t-if="request.attachment_ids">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5><i class="fa fa-paperclip"/> Attachments</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled">
                                        <t t-foreach="request.attachment_ids" t-as="attachment">
                                            <li class="mb-2">
                                                <a t-attf-href="/web/content/#{attachment.id}?download=true" class="btn btn-sm btn-outline-primary">
                                                    <i class="fa fa-download"/> <t t-esc="attachment.name"/>
                                                </a>
                                            </li>
                                        </t>
                                    </ul>
                                </div>
                            </div>
                        </t>
                        
                        <t t-if="request.response_note">
                            <div class="card mb-4">
                                <div class="card-header bg-info text-white">
                                    <h5><i class="fa fa-reply"/> Admin Response</h5>
                                </div>
                                <div class="card-body">
                                    <p t-esc="request.response_note"/>
                                </div>
                            </div>
                        </t>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5>Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <a href="/my/documents/new" class="btn btn-primary btn-block mb-2">
                                    <i class="fa fa-plus"/> New Request
                                </a>
                                <a href="/my/documents" class="btn btn-secondary btn-block">
                                    <i class="fa fa-list"/> All Requests
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Add Documents Link to Portal My Home -->
    <template id="portal_my_home_menu_documents" name="Portal My Home - Documents" inherit_id="portal.portal_my_home" priority="50">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="title">Documents</t>
                <t t-set="url" t-value="'/my/documents'"/>
                <t t-set="placeholder_count" t-value="'document_count'"/>
            </t>
        </xpath>
    </template>

</odoo>

